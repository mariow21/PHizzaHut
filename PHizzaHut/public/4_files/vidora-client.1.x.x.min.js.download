/*! vidora-client 1.3.3 04-07-2020 */

!function(n,t){var s={version:"1.3.3",rev:"68d5ea1ec45c96bafd89f1a57b8aa2345fbf87f3"},o=window,c=document,i=navigator;function r(n){o.console&&console.log&&console.log(n)}function u(n){o.console&&console.error&&console.error(n)}function d(n){throw new Error(n)}function a(n){return void 0===n}function e(n){return null===n}function p(n){return a(n)||e(n)}function f(n){return!e(n)&&"object"==typeof n}function v(n){return!p(n)&&n.constructor===Array}function l(n,t){return p(n)?t:n}function h(n,t){var e=l(n,{}),r=l(t,{});for(var o in r)e[o]=r[o];return e}function m(n){var t=l(n,{});return f(t)||d("Options should be an object."),t}function g(n){return JSON.parse(n)}function y(n){return JSON.stringify(n)}function _(n){return encodeURIComponent(n).replace(/!/g,"%21").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}function I(n){var t=[];for(var e in n){var r=n[e],o=a(r)?[e]:[e,r];t.push(o)}return t.sort(function(n,t){return(e=n)<(r=t)?-1:r<e?1:0;var e,r}),t.map(function(n){return n.map(_).join("=")}).join("&")}function S(){return(new Date).getTime()}function w(){return Math.random()}function T(){return Math.floor(65536*w())}var U=!a(o.Uint16Array)&&!a(o.crypto)?function(n){var t=new Uint16Array(n);crypto.getRandomValues(t);for(var e=[],r=0;r<t.length;r++)e.push(t[r]);return e}:function(n){for(var t=[],e=0;e<1&&e<n;e++)t.push(65535&(T()^S()));for(;e<n;e++)t.push(T());return t};function k(){return U(10).map(function(n){var t=(n>>1).toString(32);return"000".slice(t.length)+t}).join("")}o.sessionStorage;var b=o.localStorage;function H(n){var t="string"==typeof n.setItem;return!p(n)&&!t}function R(n,t,e){try{return n.setItem(t,y(e)),!0}catch(n){return r(n),!1}}function x(n,t){var e=n.getItem(t);return p(e)?null:g(e)}function q(n,t){n.removeItem(t)}function A(n,t){for(var e=0;e<n.length;e++){t(n.key(e))}}function E(n,t){return R(b,n,t)}function O(n){return x(b,n)}function C(n){q(b,n)}function j(n){A(b,n)}function D(n,t,e,r){var o=[];if(o.push(n+"="+encodeURIComponent(t)),e){var i=new Date;i.setTime(i.getTime()+1e3*e);var u="expires="+i.toUTCString();o.push(u)}o.push("path=/"),r&&o.push("domain="+r);var a=o.join("; ");c.cookie=a}var M=50,V=M,P=3,K=5,X=3*K,J="vidoraRequest:",N=".clock";function B(){return S()+":"+w()}function F(n){return n+N}function L(n){return O(n)}function $(n){C(n),setTimeout(function(){C(n)},100)}function z(n){return O(n)}function G(n){var t=F(n);C(n),$(t)}function Q(n,t,e){var r,o,i=J+B(),u=(r=F(i),o=0,setInterval(function(){E(r,o+=1)},K));return E(i,{data:n,guid:e,retry:0}),{key:i,guid:e,clock:u}}function W(){var e={};return j(function(n){var t;0===(t=n).indexOf(J)&&-1!==t.indexOf(N)&&(e[n]=L(n))}),e}function Y(){var e=[];return j(function(n){var t;0===(t=n).indexOf(J)&&-1===t.indexOf(N)&&e.push(n)}),e}var Z=!1;var nn=4;function tn(n,t,e){r("XHR Request Succeded: "+e.url)}function en(n,t,e){u("XHR Request Failed: "+e.url+" "+n)}function rn(n,t,e){u("XHR Timeout: "+e.url)}function on(n){return n}function un(n){return n}function an(n,t){var e=function(n,t,e){var r=new XMLHttpRequest;r.open(n,t.url,e);var o="onSuccess"in t?t.onSuccess:tn,i="onError"in t?t.onError:en,u="onTimeout"in t?t.onTimeout:rn,a="unmarshall"in t?t.unmarshall:on;return"crossDomainCredentials"in t&&(r.withCredentials=!0===t.crossDomainCredentials),"timeoutMs"in t&&(r.timeout=t.timeoutMs,r.ontimeout=function(){u.call({},t)}),r.onload=function(){r.readyState===nn&&200===r.status?o.call({},a(r.responseText),r.status,t):i.call({},r.statusText,r.status,r.readyState,t)},r.onerror=function(){var n="Unknown Error.";p(r.status)&&p(r.statusText)?n="Unknown Error.":"statusText"in r&&(n=r.statusText),i.call({},n,r.status,r.readyState,t)},r}(n,t,!0);if("data"in t){var r="marshall"in t?t.marshall:un;"dataType"in t&&e.setRequestHeader("Content-type",t.dataType),e.send(r(t.data))}else e.send();return e}var cn="sendBeacon";var sn=document.currentScript||document.scripts[document.scripts.length-1],fn=(sn&&sn.src||"").match(/:(\/\/[^\/?#]+)(?:[\/?#]|$)/i),ln=fn&&fn[1]||"//alloy.vidora.com",dn="https:"+ln,pn=ln,vn={marshall:y,dataType:"text/plain"};function hn(){}var mn=hn,gn=hn,yn=hn;function _n(n,t){if(h(t,vn),t.data.guid=n.guid,t.data.user_agent=window.navigator.userAgent,t.data.url=window.location.href,!p(i[cn])&&p(t.onSuccess)){(r=t.url,o=t.marshall(t.data),i[cn](r,o))&&gn(n)}else{var e=t.onSuccess||hn;t.onSuccess=function(){gn(n),e()},an("POST",t)}var r,o}function In(n,t){var e,r,o,i,u,a,c=t.map(function(n){return n[0]}),s={};0<t.length&&2<t[0].length&&(s=t[0][2]),e=n,r=c,o=m(s),i=h({api_key:e.token},o._params),u={url:l(o._baseURI,e._analyticsHost)+"/"+e.apiVersion+"/validate?"+I(i),data:{data:r}},a=mn(u),"success"in o&&(u.onSuccess=o.success),_n(a,u)}function Sn(n,t,e){n in e&&(t[n]=e[n])}function wn(n){p(n)?d("Vidora API constructed without any options."):f(n)?"apiKey"in n||d("Vidora API constructed without an API Key"):d("Vidora API should be constructed with an option object.");var t=h({},n);this.token=t.apiKey,this.apiVersion="v1";var e,r,o,i,u,a=this;function c(){e(i),i=[]}this._queue=(e=function(n){In(a,n)},r=500,o=30,i=[],u=setTimeout(function(){},0),{add:function(n){clearTimeout(u),i.push(n),i.length>=o?c():u=setTimeout(c,r)},flush:function(){clearTimeout(u),c()}}),this._analyticsHost=dn,this._apiHost=pn,this._sendMode=0,this._build=s,this._userId=null,yn(_n)}H(b)&&(mn=function(n){return Q(n,0,B())},gn=function(n){var t,e,r=n.key,o=n.clock;e=F(r),(t=o)&&clearInterval(t),$(e),G(r)},yn=function(i,u){if(!Z){Z=!0;var a=Y(),c=W();!function(n){if(n.length>M){n.sort();for(var t=n.length-V,e=0;e<t;e++){G(n.shift())}}}(a);setTimeout(function(){!function(n){for(var t in n){var e=n[t],r=L(t);!p(r)&&r!==e||(delete n[t],$(t))}}(c);var t,e,r,o,n=(t=c,e=[],a.forEach(function(n){F(n)in t||e.push(n)}),e);r=i,o=[],n.forEach(function(n){var t=z(n);if(!p(t)&&t.retry+1<P){var e=Q(t.data,0,t.guid);o.push(e)}G(n)}),o.forEach(function(n){var t=z(n.key);r(n,t.data,t.guid)}),Z=!1,u&&u()},X)}}),wn.prototype.config=function(n){var t=m(n);"analyticsHost"in t&&(this._analyticsHost=t.analyticsHost),"apiHost"in t&&(this._apiHost=t.apiHost)},wn.prototype.send=function(n,t,e){for(var r=v(t)?t:[t],o=this.getUserId(),i=this.getSessionId(),u=0;u<r.length;u++){var a=r[u],c=m(e),s={type:String(n),user_id:String(o),session_id:String(i)};p(a)||(s.content_id=String(a)),h(s,c.params);var f={};Sn("success",f,c),Sn("error",f,c),Sn("timeout",f,c);var l=this._sendMode;switch("click"!==s.type&&!c.quicksend||(l=1),l){case 1:this._queue.add([s,f,c]),this._queue.flush();break;case 0:this._queue.add([s,f,c]);break;default:d()}}};var Tn="vidoraUserId";wn.prototype.getUUID=function(){var n=function(n){for(var t=c.cookie.split("; "),e=0;e<t.length;e++){var r=t[e],o=r.indexOf("=");if(-1!==o)if(r.slice(0,o)===n){var i=r.slice(o+1);return decodeURIComponent(i)}}return null}(Tn);return e(n)&&(n=k(),D(Tn,n,5256e3)),n},wn.prototype.setUUID=function(n){D(Tn,n,5256e3)};var Un=k().slice(0,10);wn.prototype.getSessionId=function(){return Un},wn.prototype.setUserId=function(n){this._userId=n},wn.prototype.getUserId=function(){return!p(this._userId)&&""!==this._userId||(this._userId=this.getUUID()),this._userId};var kn="vidora-client",bn=wn,Hn=null,Rn={};function xn(n){n.call({},Hn,Rn)}function qn(n){var t=n[0],e=n.slice(1);t in Hn||d("Invalid api call '"+t+"'"),Hn[t].apply(Hn,e)}function An(n){v(n)?qn(n):"function"==typeof n?xn(n):d("typeof call item '"+typeof n+"' not supported.")}Rn._i=function(n,t){var e=h({apiKey:n},t);Hn=new bn(e),r(kn+" "+Hn._build.version+" "+Hn._build.rev)},function(n,t,e){if(n[e]&&!0===n[e]._init)u(kn+" included twice!");else{c=t;var r=(o=n)[e];e in n||(n[e]={}),n[e]._init=!0,n[e].push=qn,n[e].ready=xn,r&&(r.ready=xn,r.push=qn,r._q.forEach(An),r=null)}}(n,t,"vidora")}(window,document);